**项目：** 博客平台
**团队：**

* **开发者 A：** 负责 1. 用户管理模块 和 4. 权限管理模块
* **开发者 B：** 负责 2. 文章管理模块 和 3. 评论系统模块
**技术栈：** Django 4.x, MySQL 8.0, Simple JWT, Django 模板引擎 (用于前端渲染), Bootstrap 5 (可选)
**预估时长：** 大约 4-5 周 (与需求文档中的分阶段建议对齐，并留有缓冲时间)

**指导原则：**

1. **沟通：** 每日进行简短站会，同步进度、遇到的障碍和集成点。
2. **版本控制：** 从项目开始就使用 Git (例如 GitHub, GitLab)。使用特性分支 (feature branches) 进行开发，通过 Pull Requests (PRs) 进行代码审查后合并到 `main` 或 `develop` 分支。
3. **代码审查：** 每位开发者审查另一位的 PR，确保代码清晰、正确并符合规范。
4. **模块化：** 遵循建议的 `apps` 结构 (`users`, `articles`, `comments`, `utils`)。
5. **集成点：** 特别注意模块交互的地方 (例如：文章/评论中的 User 对象，视图中的权限检查)。
6. **文档：** 开发过程中同步维护基础文档 (例如：模型说明、关键函数注释、README 更新)。

---

**阶段一：基础搭建与核心模型 (预估时长：1 周)**

* **目标：** 初始化项目，定义核心数据模型，实现基础用户认证和文章展示功能。
* **共同任务：**
    ✅*初始化 Django 项目和 Git 仓库。
    ✅*   配置基础 `settings.py` (数据库连接 - MySQL, Secret Key, Installed Apps)。
    ✅*定义项目结构 (`apps/`, `templates/`, `static/`, `config/`, `utils/`)。
    ✅*   创建基础的 `pyproject.toml` 文件。
* **开发者 A (用户管理)：**
  * ✅**任务 1.1:** 实现自定义用户模型 (`users` app)，继承 `AbstractUser` 或 `AbstractBaseUser`。包含角色字段 (例如 `is_staff`，如果后续需要更复杂的角色，可添加自定义字段)。
  * ✅**任务 1.2:** 实现基础用户注册视图和模板 (用户名/邮箱，密码)。暂时无需邮箱验证。
  * ✅**任务 1.3:** 实现用户登录/登出视图和模板。集成 `django-simple-jwt` 进行基础的 Token 生成/处理 (如果纯用模板，重点关注 Session/Cookie 存储认证信息，或者在模板交互中处理 JWT)。
  * ✅**任务 1.4:** 为自定义用户模型设置基础的 Django Admin 后台管理界面。
  * ✅**任务 1.5:** 定义初始的用户相关 URL (`users/urls.py`)。
* ✅ **开发者 B (文章管理)：**
  * ✅ **任务 1.6:** 实现文章模型 (`articles` app)，包含字段：标题、内容、作者 (ForeignKey 指向用户模型)、创建/更新时间戳、状态 (草稿/发布)、可见性 (公开/私密)。
  * ✅ **任务 1.7:** 实现分类 (Category) 和标签 (Tag) 模型 (`articles` app)。定义与文章模型的多对多 (ManyToMany) 关系。
  * ✅ **任务 1.8:** 实现基础的文章列表和详情视图及模板 (目前仅只读)。显示文章基本信息、分类、标签。
  * ✅ **任务 1.9:** 集成基础的 Markdown 渲染，用于文章内容显示 (例如在模板中使用 `markdown` 库或自定义模板过滤器)。
  * ✅ **任务 1.10:** 为文章、分类、标签设置基础的 Django Admin 后台管理界面。
  * ✅ **任务 1.11:** 定义初始的文章相关 URL (`articles/urls.py`)。
* **集成/审查：**
  * ✅确保 `Article.author` 正确关联到开发者 A 实现的自定义用户模型。
  * ✅审查初始的模型定义和数据库迁移 (Migrations)。
  * ✅基础功能检查：用户能否注册、登录，并查看文章列表/详情页（使用占位文章）？

---

**阶段二：功能扩展与基础权限 (预估时长：1.5 周)**

* **目标：** 实现核心的 CRUD 操作，用户个人信息管理，邮箱验证，基础授权控制，以及评论系统初步结构。
* **开发者 A (用户/权限)：**
  * ✅**任务 2.1:** 实现注册时的邮箱验证功能 (使用 Django 的邮件后端，可考虑 `django-allauth` 简化流程或自建流程)。
  * ✅**任务 2.2:** 实现注册时的邮箱验证功能。
  * ✅**任务 2.3:** 实现个人信息编辑视图和模板 (头像上传 - 使用 `Pillow` 库处理图片，密码修改 - 使用 Django 内置的表单/视图)。
  * ✅**任务 2.4:** 实现用户激活/禁用逻辑 (管理员功能 - 初期可通过 Django Admin 实现)。
  * ✅**任务 2.5:** 使用 `@login_required` 装饰器或 `LoginRequiredMixin` 为需要认证的视图（如个人信息编辑、文章创建）实现基础的路由/视图保护。
  * ✅**任务 2.6:** 定义基础角色概念 (普通用户 User, 管理员 Admin)。开始构建权限逻辑的基础结构 (例如放在 `utils/permissions.py` 中)。
* **开发者 B (文章/评论)：**
  * ✅**任务 2.7:** 实现文章创建/更新视图和模板。确保只有登录用户可以访问。自动将 `author` 关联到 `request.user`。
  * ✅**任务 2.8:** 实现文章删除视图和逻辑 (权限检查暂时留空，后续添加)。
  * ✅**任务 2.9:** 在视图和模板中实现文章状态 (草稿/发布) 和可见性 (公开/私密) 的逻辑。根据状态和可见性过滤文章列表。
  * ✅**任务 2.10:** 实现文章点赞/收藏功能：
    * 模型: `Like` / `Favorite` (包含 User ForeignKey, Article ForeignKey)。
    * 视图逻辑: 通过简单的 POST 请求处理切换逻辑 (如果熟悉，也可使用基础 AJAX)。
    * 模板: 显示点赞/收藏按钮及数量。
  * ✅**任务 2.11:** 实现基础评论模型 (`comments` app)：内容、作者 (ForeignKey 指向用户)、文章 (ForeignKey 指向文章)、时间戳。
  * **任务 2.12:** 在文章详情页实现基础的评论提交表单和视图。自动关联 `author` 和 `article`。线性展示评论 (暂无嵌套)。
* **集成/审查：**
  * 开发者 A 的权限装饰器应能保护开发者 B 的创建/更新视图。
  * 文章作者关联功能应正常工作。
  * 代码审查 CRUD 逻辑和表单处理。

---

**阶段三：高级权限、评论功能与优化 (预估时长：1.5 周)**

* **目标：** 实现对象级权限控制，高级评论功能 (嵌套、审核)，敏感词过滤，并为未来的数据统计功能预留接口。
* **开发者 A (权限)：**
  * ✅**任务 3.1:** 实现对象级权限控制 (Object-Level Permissions)：
    * 逻辑: 仅文章作者或管理员可以编辑/删除其文章。
    * 方法: 在视图中使用自定义权限检查逻辑，或如果预计需要复杂的对象级规则，可探索 `django-guardian` (但对当前范围可能有点过度设计)。实现类似需求示例中的 `IsOwnerOrAdmin` 逻辑。
  * ✅**任务 3.2:** 实现基于角色的访问控制 (RBAC)：
    * 确保管理员用户拥有不同的能力 (例如访问特定的管理后台区域、禁用用户、审核评论)。使用 `user.is_staff` 或自定义角色/用户组。
  * ✅**任务 3.3:** 实现后台管理权限控制 (确保只有 `is_staff` 用户可以访问 `/admin/`)。
  * ✅**任务 3.4:** 在所有相关视图（用户资料、文章、评论）中完善权限检查逻辑。
  * **任务 3.5:** (可选占位) 为数据统计模块定义潜在的接口/信号 (例如：用户登录信号，文章查看信号)。实现访问日志中间件 (记录基础请求信息)。
  * **任务 3.6:** 如果需要任何 API 端点 (即使是简单的 AJAX)，现在配置 DRF、序列化器 (Serializers) 和 DRF 权限类。定义基础 API 结构 (`/api/v1/...`)。设置 Swagger/OpenAPI 文档生成。
* **开发者 B (文章/评论)：**
  * **任务 3.7:** 实现嵌套评论：
    * 模型: 在评论模型中添加 `parent` ForeignKey (自引用)。
    * 视图: 修改评论获取逻辑以处理层级关系。
    * 模板: 实现递归模板 include 或相应逻辑来正确显示嵌套评论。
  * **任务 3.8:** 实现评论审核机制：
    * 模型: 在评论模型中添加 `is_approved` 布尔字段 (默认为 False)。
    * 视图: 过滤只显示 `is_approved=True` 的评论。
    * Admin: 允许管理员通过 Django Admin 审核评论。
  * **任务 3.9:** 实现敏感词过滤：
    * 创建敏感词列表/模型 (简单实现即可)。
    * 实现逻辑 (例如在评论模型的 `save` 方法或表单的 `clean` 方法中) 检查评论内容，如果包含敏感词则拒绝或标记该评论。
  * **任务 3.10:** 实现评论删除权限：检查用户是否为评论作者或管理员，才允许删除。集成开发者 A 提供的权限检查。
  * **任务 3.11:** 使用 Bootstrap 5 (如果选择使用) 优化文章/评论模板的响应式布局。
  * **任务 3.12:** (可选占位) 在文章模型/视图中添加浏览量计数逻辑 (在详情页加载时简单递增，注意潜在的竞态条件或后续更健壮的追踪需求)。为热门文章的 Redis 缓存做准备 (如果时间允许，实现基础 Redis 配置)。
* **集成/审查：**
  * 彻底测试权限逻辑：用户 A 不能编辑用户 B 的文章，管理员可以编辑/删除任何内容，用户可以删除自己的评论等。
  * 测试评论嵌套、审核流程和敏感词过滤功能。

---

**阶段四：测试、文档与收尾 (预估时长：1 周)**

* **目标：** 确保应用稳定性，编写测试用例，最终确定文档，准备交付物。
* **共同任务：**
  * **任务 4.1:** 编写单元测试 (Unit Tests)：
    * 开发者 A: 测试用户注册、登录、个人信息更新、权限逻辑 (对权限类/函数进行单元测试)。
    * 开发者 B: 测试文章/评论的 CRUD、嵌套逻辑、过滤逻辑。
    * 目标是覆盖关键路径 (如果构建了 API，至少覆盖 5 个 API 测试；否则重点关注视图/模型测试)。
  * **任务 4.2:** 集成测试：手动测试端到端的用户流程 (注册 -> 创建文章 -> 评论 -> 编辑文章 -> 登出等)。
  * **任务 4.3:** 数据库查询性能优化：使用 Django Debug Toolbar 审查关键查询 (例如文章列表、评论加载)。实施优化手段，如 `select_related` / `prefetch_related`。在必要时添加数据库索引。
  * **任务 4.4:** 完成数据库设计文档 (包含 ER 图)。
  * **任务 4.5:** 完成 API 文档 (如果构建了 API，则提供 Swagger/OpenAPI 文档)。
  * **任务 4.6:** 准备部署文档 (包含 `pyproject.toml` 和基础环境设置说明)。
  * **任务 4.7:** 代码清理和重构。确保代码风格一致。
  * **任务 4.8:** 准备项目演示 PPT (5 分钟)。
  * **任务 4.9:** 进行最终代码审查并将代码合并到 `main` 分支。
* **交付物清单：**
  * [ ] 完整源代码 (Git 仓库)
  * [ ] 数据库设计文档 (含 ER 图)
  * [ ] API 接口文档 (若适用，例如 Swagger)
  * [ ] 部署文档 (含 `pyproject.toml`)
  * [ ] 项目演示 PPT (5 分钟)

---

**待办/延后功能：**

* **数据统计模块:** 用户活跃度统计、文章访问量统计、数据可视化。已在阶段三预留接口/占位符。
* **高阶/加分项功能:** 第三方登录 (GitHub/微信)、Docker 部署、Elasticsearch 文章搜索、Celery 异步任务。

**潜在风险与缓解措施：**

* **集成问题：** 保持定期沟通和早期集成测试。明确模块间的接口。
* **范围蔓延：** 严格遵守既定需求。推迟非核心功能。
* **技术难点：** 如果对特定库 (JWT, Markdown, 嵌套实现) 不熟悉，预留研究时间。对于难点可以进行结对编程。
* **时间估算偏差：** 对各阶段时长保持灵活性。如果时间紧张，优先保证核心功能的完成。

这个计划提供了一个结构化的方法，在两位开发者之间逻辑地分配了工作，并确保了关键集成点的处理。请记住，根据实际进展和遇到的挑战，可以灵活调整计划。
